image: python:3.7-stretch

stages:
- test
- publish

test:
  stage: test
  script:
  - pip install -r dev-requirements.txt
  - tox

publish:
  only: [tags]
  stage: publish
  image: python:3.7-stretch
  script:
  - pip install -r dev-requirements.txt
  - tox
  - twine upload -u ${PYPI_USER} -p ${PYPI_PASSWORD} .tox/dist/*
